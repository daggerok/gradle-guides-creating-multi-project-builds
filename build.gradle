/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */

buildscript {
  ext {
    spokVersion = '1.0-groovy-2.4'
    asciidoctorjPdfVersion = '1.5.0-alpha.16'
  }
  dependencies {
    classpath "org.asciidoctor:asciidoctorj-pdf:$asciidoctorjPdfVersion"
  }
}

plugins {
  id 'org.asciidoctor.convert' version '1.5.7' apply false
}

allprojects {

  version = ''
  group = 'com.github.daggerok'

  repositories {
    jcenter()
  }

  apply plugin: 'base'

  defaultTasks 'clean', 'build'

  clean.doFirst {
    delete file('opt')
  }
}

project ':libs:greeting-library', {

  apply plugin: 'groovy'

  dependencies {
    compile 'org.codehaus.groovy:groovy:2.4.10'
  }
}

project ':docs', {

  apply plugin: 'org.asciidoctor.convert'

  asciidoctor {
    sources {
      include 'greeter.adoc'
    }
    backends 'html5', 'pdf'
  }

  assemble.dependsOn 'asciidoctor'
}

project ':app', {

  apply plugin: 'java'
  apply plugin: 'application'

  mainClassName = 'daggerok.Greeter'

  dependencies {
    implementation project(':libs:greeting-library')
  }

  [distZip, distTar].each { distTask ->
    distTask.from project(':docs').asciidoctor, { }
    distTask.exclude '*.html'
    distTask.exclude '*.pdf'
    distTask.into 'opt'
  }
}

def spockProjects = [
    'app',
    'greeting-library',
]

configure(allprojects.findAll { spockProjects.contains it.name }) {

  apply plugin: 'groovy'

  dependencies {
    testImplementation "org.spockframework:spock-core:$spokVersion", {
      exclude module : 'groovy-all'
    }
  }
}
